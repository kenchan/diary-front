---
import { marked } from 'marked';
import hljs from 'highlight.js'
import 'highlight.js/styles/github.css';

import Layout from '../layouts/Layout.astro';
import ArticleCard from '../components/ArticleCard.astro';

const { slug } = Astro.params;

const response = await fetch("https://diary.shu-cream.net/graphql",
  {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({
      query: `
        query {
          article(slug: "${slug?.replaceAll('"', '\\\"')}") {
            title
            body
          }
        }
      `
    })
  }
)

const json = await response.json();
const article: Article = await json.data.article;

marked.setOptions({
  async: true,
  highlight: (code, lang) => {
    return hljs.highlightAuto(code).value;
  }
})
---

<Layout title={article.title + " - けんちゃんくんさんのWeb日記"}>
  <ArticleCard title={article.title} body={article.body}></ArticleCard>
</Layout>
