---
title: 'capybara-webkitでAjax後のsave_and_open_page'
slug: 'capybara-webkitでAjax後のsave_and_open_page'
publishedOn: 2011-10-24
createdAt: 2015-08-06 01:43:33 +0900
updatedAt: 2015-08-06 01:43:33 +0900
---
capybara-webkitでsave\_and\_open\_pageを使ってデバッグをするとき、その前にAjaxを使っているとレスポンスを待たずにブラウザが立ちあがってしまいます。
例えば、下のように書くと意図しない動作に頭を悩ませることになります。

```
もし "送信する"ボタンを押す # ここでAjax
かつ デバッグ # レスポンスが返ってきてたり、返ってきてなかったりする

ならば "hogehoge"と表示されていること # ここでは処理が終わるまで待つ
```

Capybaraでは、画面の検証をする場合はデフォルトで2秒までAjaxでの書き換えを待ってくれるのですが、save\_and\_open\_pageではそれを待ってくれないようです。
とりあえず検証しさえすれば待ってくれるので、以下のようにするといいかもしれません。

```
もし "送信する"ボタンを押す

ならば "送信する"と表示されていること # 絶対マッチするやつ
かつ デバッグ # やった！原因がわかったぞ！
```

ただ、これはsave\_and\_open\_pageがJavascriptの処理を待ってくれればいいような気がするので、そのうちちゃんと深追いすることにします。
